<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{admin/dashboardLayout.html}">
	
<head>
<meta charset="UTF-8">
<title>List Province</title>

</head>
<body>

	  <div  class="row" layout:fragment="content">
	
   <div id="okeroiload" class="col-12 col-xl-8">
                    <div id="loadtable" class="card card-body border-0 shadow mb-4">
                        <h2 class="h5 mb-4">Category list</h2>
                 <div class="dataTable-top"><div class="dataTable-dropdown"><label><select class="dataTable-selector"><option value="5">5</option><option value="10" selected="">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option></select> entries per page</label></div><div class="dataTable-search"><input class="dataTable-input" placeholder="Search..." type="text"></div></div>
               
    <div class="table-responsive py-4">
    <table class="table table-flush" id="datatable">
        <thead class="thead-light">
        <tr>
            <th >Idcategory</th>
            <th >category name</th>
            <th >Status</th>
            <th>functional</th>
            
        </tr>
        </thead>
        <tbody>
        <tr class="categorys" th:each = "list : ${listcategory}">
            <td class="idcategory"  th:value=${list.id}>[[${list.id}]]</td>
            <td class="categoryName" th:text=${list.categoryName}></td>
            <td th:if="${list.status == 0}"  ><span class=" btn badge bg-secondary activeCategory" th:value=${list.status}>Active</span></td>
            <td th:if="${list.status == 1}" ><span class="btn badge bg-primary activeCategory"th:value=${list.status} >Disable</span></td>
            <td><a  class="btn-sm btn-outline-danger"><i class="fa fa-trash"></i></a></td>
          
        </tr>
       
        </tbody>
    </table>
    </div>

      <div class="dataTable-bottom"><div class="dataTable-info">Showing 1 to 10 of 57 entries</div>
      
      <nav aria-label="Page navigation example">
    <ul class="pagination mb-0">
        <li class="page-item">
            <a class="page-link" href="#">Previous</a>
        </li>
        <li class="page-item active">
            <a class="page-link" href="#">1</a>
        </li>
        <li class="page-item ">
            <a class="page-link" href="#">2</a>
        </li>
        <li class="page-item">
            <a class="page-link" href="#">3</a>
        </li>
        <li class="page-item">
            <a class="page-link" href="#">4</a>
        </li>
        <li class="page-item">
            <a class="page-link" href="#">5</a>
        </li>
        <li class="page-item">
            <a class="page-link" href="#">Next</a>
        </li>
    </ul>
</nav>
      </div>
                    </div>
                  
                </div>

  		
                <div class="col-12 col-xl-4">
                    <div class="row">
                        <div class="col-12 mb-4">
                            <div class="card shadow border-0 text-center p-0">
                            <h2 class="h5 mb-4 margintop">Add Category</h2>
                            <form id="formcategory" action="" method="post">
                                 <div class="col-sm-8 mb-3">
                                 <div class="form-group">
                                        <label class="labelcategory" for="idcategory">Category Id</label>
                                        <input class="form-control" id="idcategory" name="id" type="text" placeholder=" Category Id" readonly>
                                    </div>
                                    <div class="form-group top">
                                        <label class="labelcategory" for="category">Category Name</label>
                                        <input class="form-control categoryName1" id="categoryName" type="text" name="Category_Name" placeholder="Category Name" required>
                                    </div>
                                </div>
                                <div class="card-body pb-5">
                                    
                                   <a id="btnSaveCategory"  class="btn btn-outline-info">
											<i class="fas fa-save"></i> 
											<span >Save</span>
											
										</a>
                                    <a id="btnupdate" class="btn btn-outline-success">
											<i class="fas fa-save"></i> 
											<span >Update</span>
											
										</a>
                                   <button type="reset" id="btnreset" class="btn btn-gray-900"><i class="fa fa-refresh" aria-hidden="true"></i>Reset</button>
                                   
                                </div>
                            </form>
                                
                             </div>
                        </div>
                          
                       <div class="swal2-container swal2-center swal2-backdrop-show" style="overflow-y: auto;     display: none;"><div aria-labelledby="swal2-title" aria-describedby="swal2-html-container" class="swal2-popup swal2-modal swal2-icon-success swal2-show" tabindex="-1" role="dialog" aria-live="assertive" aria-modal="true" style="display: grid;"><button type="button" class="swal2-close" aria-label="Close this dialog" style="display: none;">×</button><ul class="swal2-progress-steps" style="display: none;"></ul><div class="swal2-icon swal2-success swal2-icon-show" style="display: flex;"><div class="swal2-success-circular-line-left" style="background-color: rgb(255, 255, 255);"></div>
      <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>
      <div class="swal2-success-ring"></div> <div class="swal2-success-fix" style="background-color: rgb(255, 255, 255);"></div>
      <div class="swal2-success-circular-line-right" style="background-color: rgb(255, 255, 255);"></div>
  
    </div><img class="swal2-image" style="display: none;"><h2 class="swal2-title" id="swal2-title" style="display: block;">Success</h2><div class="swal2-html-container" id="swal2-html-container" style="display: block;">Your category has been saved</div><input class="swal2-input" style="display: none;"><input type="file" class="swal2-file" style="display: none;"><div class="swal2-range" style="display: none;"><input type="range"><output></output></div><select class="swal2-select" style="display: none;"></select><div class="swal2-radio" style="display: none;"></div><label for="swal2-checkbox" class="swal2-checkbox" style="display: none;"><input type="checkbox"><span class="swal2-label"></span></label><textarea class="swal2-textarea" style="display: none;"></textarea><div class="swal2-validation-message" id="swal2-validation-message" style="display: none;"></div><div class="swal2-actions" style="display: flex;"><div class="swal2-loader"></div><button type="button" class="swal2-confirm btn btn-primary" aria-label="" style="display: inline-block;">OK</button><button type="button" class="swal2-deny" aria-label="" style="display: none;">No</button><button type="button" class="swal2-cancel btn btn-gray" aria-label="" style="display: none;">Cancel</button></div><div class="swal2-footer" style="display: none;"></div><div class="swal2-timer-progress-bar-container"><div class="swal2-timer-progress-bar" style="display: none;"></div></div></div></div>
 	
 	<div class="notyf" style="justify-content: flex-start; align-items: flex-end;"></div>
 	<div class="notyf-announcer" aria-atomic="true" aria-live="polite" style="border: 0px; clip: rect(0px, 0px, 0px, 0px); height: 1px; margin: -1px; overflow: hidden; padding: 0px; position: absolute; width: 1px; outline: 0px;">This action is not allowed.</div>
 
 	<div class="jq-toast-wrap" style="inset: 73px auto auto 1270px;"><div class="jq-toast-single jq-has-icon jq-icon-warning" style="text-align: left;"><span class="jq-toast-loader"></span><span class="close-jq-toast-single">×</span><h2 class="jq-toast-heading">Warning</h2>Please enter category name!</div><div class="jq-toast-single jq-has-icon jq-icon-info" style="text-align: left; display: none;"><span class="jq-toast-loader jq-toast-loaded" style="-webkit-transition: width 2.6s ease-in;                       -o-transition: width 2.6s ease-in;                       transition: width 2.6s ease-in;                       background-color: #fff;"></span><h2 class="jq-toast-heading">Info</h2>Important information</div></div>
 
  <div class="jq-toast-wraps" style="inset: 73px auto auto 1240px;"><div class="jq-toast-single jq-has-icon jq-icon-error" style="text-align: left; "><span class="close-jq-toast-single">×</span><h2 class="jq-toast-heading">Error</h2>Ducplicate category name !</div></div>

 
 <script>

  
 //update status
  $(document).ready(function(){
	  $(".activeCategory").click(function(){
		  var id = $(this).closest("tr").find(".idcategory").attr("value");
		  var  status = $(this).closest("tr").find(".activeCategory").text();
		 
		  var self = $(this);
		  $.ajax({
				url:"/admin/category/updatestatus",
				type: "POST",
				data:{
					id:id,
					status:status,
				},
				success: function(value){
					//self.closest("tr").remove();
					console.log(value)
					if(value === "0"){
						self.removeClass( "btn badge bg-secondary" ).addClass( "btn badge bg-primary" );
						self.html("Disable");
						
					}
					if(value === "1")
					{
						self.removeClass( "btn badge bg-primary" ).addClass( "btn badge bg-secondary " );
						self.html("Active");
					}
					
				}
			}) 
	  })
	  
	  // reset form
	  $("#btnreset").click(function(){
		  $("#btnSaveCategory").show();
		  $("#btnupdate").hide();
	  })
	  // bingding
      $(".categorys").click(function(){
    	  var id = $(this).closest("tr").find(".idcategory").attr("value");
    	  var categoryName = $(this).closest("tr").find(".categoryName").text();
    	  $("#btnSaveCategory").hide();
    	  $("#btnupdate").show();
 			$("#idcategory").val(id);
 			$("#categoryName").val(categoryName);
      })
  })
             $(document).ready(function(){
                 
	 
					// save 
					$("#btnSaveCategory").click(function(){
						var formcategory = $("#formcategory").serializeArray();
						console.log(formcategory);
					
						json = {};
						$.each(formcategory, function(i, field){
				    		json[field.name] = field.value;
							if(field.name === "Category_Name" && field.value ===""){
							$(".jq-toast-wrap").show();
								setTimeout(() =>{
            			 $(".jq-toast-wrap").hide();
						},5000);
							return false;
							
							}else{
												
				    $.ajax({
						url:"/admin/category/ajaxaddcategory",
						type: "POST",
						data:{
							dataJson:JSON.stringify(json),
						
						},

				}).done(function(data){
					console.log(data);
					if(data === "Successful"){
						 $(".swal2-container").show();
						 setTimeout(() =>{
            			 $(".swal2-container").hide();
						},2500);
						$("#formcategory").trigger("reset");
						setTimeout(() =>{
							$("#taongcuch").load("http://localhost:8080/admin/category/add");
							},2499);
						
					}
					if(data === "false"){
						$.Toast("Error", "Your category name is duplicated !", "success", {
					          has_icon:true,
					          has_close_btn:true,
								stack: true,
					          fullscreen:true,
					          timeout:5000,
					          sticky:false,
					          has_progress:true,
					          rtl:false,
					      });
						
						
					}
				})
				}
			});		
		})
								// update 
					$("#btnupdate").click(function(){
						var formcategory = $("#formcategory").serializeArray();
						var namecategory = $(this).find(".categoryName1").attr("value");
						const myElement = document.getElementById("categoryName").value;
						console.log(myElement);
					
						json = {};
						$.each(formcategory, function(i, field){
				    		json[field.name] = field.value;
							if(field.name === "Category_Name" && field.value ===""){
							$(".jq-toast-wrap").show();
								setTimeout(() =>{
            			 $(".jq-toast-wrap").hide();
						},5000);
							return false;
							
							}else{
												

				}
			});		if(myElement === ""){
				return false
			}
			else{
			    $.ajax({
					url:"/admin/category/ajaxupdatecategory",
					type: "POST",
					data:{
						dataJson:JSON.stringify(json),
					
					},

			}).done(function(data){
				console.log(data);
				if(data === "Successful"){
					 $(".swal2-container").show();
					 setTimeout(() =>{
        			 $(".swal2-container").hide();
					},2500);
					$("#formcategory").trigger("reset");
					setTimeout(() =>{
						$("#taongcuch").load("http://localhost:8080/admin/category/add");
						},2400);
					
				}
				if(data === "false"){
					$.Toast("Error", "Your category name is duplicated !", "success", {
				          has_icon:true,
				          has_close_btn:true,
							stack: true,
				          fullscreen:true,
				          timeout:5000,
				          sticky:false,
				          has_progress:true,
				          rtl:false,
				      });
					
					
				}
			})
			}

		})
})

</script>
                    </div>
                </div>
            </div>
 


</body>
</html>